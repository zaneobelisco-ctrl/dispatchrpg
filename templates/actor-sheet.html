<form class="dispatch-sheet duke-collins">
  <header class="sheet-header">
    <div class="left">
      <div class="portrait">
        <img src="{{#if actor.img}}{{actor.img}}{{else}}icons/svg/mystery-man.svg{{/if}}" alt="avatar" id="pc-portrait"/>
        <div class="portrait-controls">
          <button type="button" class="btn-upload-photo btn">Upload Foto</button>
        </div>
      </div>
    </div>

    <div class="center">
      <input class="char-name" name="name" type="text" value="{{actor.name}}" placeholder="Nome do Personagem" />
      <div class="meta-row">
        <div class="meta-field"><label>RaÃ§a</label><input class="meta small" name="data.raca" placeholder="RaÃ§a" value="{{data.raca}}" /></div>
        <div class="meta-field"><label>Classe Social</label><input class="meta small" name="data.classeSocial" placeholder="Classe Social" value="{{data.classeSocial}}" /></div>
        <div class="meta-field"><label>Idade</label><input class="meta tiny" name="data.idade" placeholder="Idade" value="{{data.idade}}" /></div>
        <div class="meta-field"><label>Altura</label><input class="meta tiny" name="data.altura" placeholder="Altura" value="{{data.altura}}" /></div>
        <div class="meta-field"><label>Peso</label><input class="meta tiny" name="data.peso" placeholder="Peso" value="{{data.peso}}" /></div>
      </div>
    </div>

    <div class="right">
      <div class="status-block pv">
        <label>PV</label>
        <input name="data.pv" value="{{data.pv}}" />
      </div>
      <div class="status-block pp">
        <label>PP</label>
        <input name="data.pp" value="{{data.pp}}" />
      </div>
      <div class="status-block san">
        <label>SAN</label>
        <input name="data.san" value="{{data.san}}" />
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button type="button" class="tab active" data-tab="atributos">Atributos</button>
    <button type="button" class="tab" data-tab="pericias">PerÃ­cias</button>
    <button type="button" class="tab" data-tab="status">Status</button>
    <button type="button" class="tab" data-tab="poderes">Poderes</button>
    <button type="button" class="tab" data-tab="biografia">Biografia</button>
  </nav>

  <section class="tabcontent" data-tabcontent="atributos">
    <div class="attributes-grid">
      {{#each data.atributos}}
      <div class="attr" data-attr="{{@key}}">
        <label>{{@key}}</label>
        <input type="number" name="data.atributos.{{@key}}" value="{{this}}" />
      </div>
      {{/each}}
    </div>
  </section>

  <section class="tabcontent" data-tabcontent="pericias" style="display:none">
    <div class="pericias-grid two-columns">
      {{#if data.pericias}}
        {{#each data.pericias}}
        <div class="skill-card">
          <div class="skill-row">
            <div class="skill-label">{{@key}}</div>
            <input class="skill-input" type="number" name="data.pericias.{{@key}}" value="{{this}}" />
            <button type="button" class="roll btn-small" data-skill="{{@key}}">ðŸŽ²</button>
          </div>
        </div>
        {{/each}}
      {{else}}
        <div>Nenhuma perÃ­cia definida.</div>
      {{/if}}
      <p class="hint">Duplo clique no nÃºmero da perÃ­cia: +1. Shift + duplo clique: -1.</p>
    </div>
  </section>

  <section class="tabcontent" data-tabcontent="status" style="display:none">
    <div class="status-grid">
      <div class="status-item">
        <label>Iniciativa</label>
        <div class="inline-row">
          <div class="computed-value">+{{computed.iniciativaBonus}}</div>
          <button type="button" class="roll-iniciativa btn-small">ðŸŽ²</button>
        </div>
      </div>
      <div class="status-item">
        <label>Movimento (m/turno)</label>
        <div class="computed-value">{{computed.movimento}} m</div>
      </div>
      <div class="status-item">
        <label>Taxa de Cura</label>
        <div class="inline-row">
          <div class="computed-value">1d6 + {{computed.taxaCuraBonus}}</div>
          <button type="button" class="roll-taxa btn-small">ðŸŽ²</button>
        </div>
      </div>
    </div>
  </section>

  <section class="tabcontent" data-tabcontent="poderes" style="display:none">
    <div class="powers-list">
      <label>Poderes e TÃ©cnicas</label>
      <textarea name="data.poderes" placeholder="Descreva suas tÃ©cnicas...">{{data.poderes}}</textarea>
    </div>
  </section>

  <section class="tabcontent" data-tabcontent="biografia" style="display:none">
    <label>Biografia</label>
    <textarea name="data.biografia" placeholder="HistÃ³ria, background...">{{data.biografia}}</textarea>
  </section>

     <footer class="sheet-footer">
    <div class="footer-left">Dispatch RPG â€” Ficha</div>
    <div class="footer-right">
      <button type="button" class="btn-save-sheet btn" style="margin-left:12px">Salvar</button>
    </div>
  </footer>


</form>

<script>
document.addEventListener('click', (ev) => {
  const t = ev.target;
  if (t.classList && t.classList.contains('tab')) {
    const app = t.closest('.app') || document;
    app.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const name = t.dataset.tab;
    app.querySelectorAll('.tabcontent').forEach(x=>x.style.display='none');
    const target = app.querySelector(`[data-tabcontent="${name}"]`);
    if (target) target.style.display='block';
  }
});
</script>
